# API Server for Custom Analytics

This is the server used for getting the data on the server, the user activity.

To build the application go through these step

Install the postgres in the local system and make a user named as `memex`
```sh
$ sudo -u postgres psql
postgres=# ALTER USER memex PASSWORD 'PASSWORD';
```

Exit out and type for login with memex user and password
```sh
$ sudo psql -U memex -d memex -W
```

Create the database and tables
```sh
postgres=# create database memex;
postgres=# create table users (id varchar(512) NOT NULL PRIMARY KEY, install_time timestamp NOT NULL default to_timestamp(0));
postgres=# create table eventlog (id varchar(512) NOT NULL, time timestamp NOT NULL default to_timestamp(0), type varchar(500) NOT NULL, data JSON, foreign key(id) REFERENCES users(id));
```

Now clone the repo by typing

```sh
$ git clone https://github.com/WorldBrain/AnalyticsAPIs.git
```

Change the location to repository
```sh
$ cd AnalyticsAPIs
```

Install all the dependency
```sh
$ pip install -r requirements.txt
```

Copy `config.example.py` and rename it to `config.py` and change the password, db name, host and port.

Copy `app/api/config.example.py` and rename it to `app/api/config.py` and change the password, db name, host and port.


Run the server
```sh
$ python manage.py
```

Now we can send the request to endpoints `/api/v1/returnToken` and `/api/v1/eventlog`

The params for `/api/v1/returnToken` is install_time and return the token that is generated by `jwt` library. This token will save in the extension as a user id.

The params for `/api/v1/eventlog`
```sh
{
    
    "id": "user_id",
    "data": [
        {
            "data": {},
            "time": time,
            "type": "type"
        },
        ...
    ]
}
```

It stores the data in db, this data will visualise by redash.
